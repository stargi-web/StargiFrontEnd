<p-toast></p-toast>

<div class="m-5 grid">
  <div class="col-12 grid">
    <!-- Recuadro con borde visible -->
    <div class="col p-0 grid">
      <div class="flex col align-items-center">
        <p-button
          icon="pi pi-arrow-left"
          (onClick)="
            userRole === 'admin' && folderHistory.length === 0
              ? adminLoadAllUserFolders()
              : goBack()
          "
          [disabled]="
            folderHistory.length > 0 || !isAdminParent ? 'false' : 'true'
          "
          class="align-items-end my-2"
        />
        <div class="text-base font-medium text-700 m-2">
          {{
            folderHistory.length > 0
              ? folderHistory[folderHistory.length - 1].path
              : ""
          }}{{
            folderHistory.length > 0 && selectedFile ? "/ " + selectedFile : ""
          }}
        </div>
      </div>
      <div class="flex col justify-content-end align-items-center">
        <p-fileUpload
          *ngIf="folderHistory.length > 0"
          mode="basic"
          chooseIcon="pi pi-upload"
          maxFileSize="1000000"
          (onSelect)="uploadOnFileSelect($event)"
          [auto]="true"
          chooseLabel="Subir Archivo"
        />
        <!-- BotÃ³n Crear Carpeta con Icono -->
        <p-button
          class="my-2 ml-2"
          *ngIf="!isCreatingFolder || !isAdminParent"
          label="Crear Carpeta"
          severity="secondary"
          icon="pi pi-folder"
          (click)="startFolderCreation()"
        ></p-button>

        <!-- Formulario para crear la carpeta (aparece cuando isCreatingFolder es true) -->
        <div *ngIf="isCreatingFolder" class="flex flex-wrap align-items-center">
          <input
            class="m-2"
            type="text"
            pInputText
            [(ngModel)]="newFolderName"
            placeholder="Nombre de la carpeta"
          />
          <p-button
            class="m-2"
            label="Confirmar"
            severity="success"
            icon="pi pi-check"
            (click)="confirmFolderCreation()"
          ></p-button>
          <p-button
            class="m-2"
            label="Cancelar"
            severity="danger"
            icon="pi pi-times"
            (click)="cancelFolderCreation()"
          ></p-button>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 grid">
    <!-- Recuadro con borde visible -->
    <div class="storageCard p-card col p-4 h-25rem">
      <div class="grid">
        <!--ADMIN Grid de carpetas -->
        <ng-container *ngIf="userRole === 'admin' && isAdminParent">
          <div
            class="folderCard flex flex-column m-2"
            *ngFor="let userFolder of adminUsersFolders"
            (click)="adminLoadParentFolderByUser(userFolder.id)"
          >
            <i class="folderIcon pi pi-folder folder-icon"></i>
            <span class="folder-name">{{ userFolder.userName }}</span>
          </div>
        </ng-container>
        <!-- Grid de carpetas -->
        <div
          class="folderCard flex flex-column m-2"
          *ngFor="let folder of folders"
          (click)="selectFolder(folder)"
        >
          <i class="folderIcon pi pi-folder folder-icon"></i>
          <span class="folder-name">{{ folder.name }}</span>
        </div>
        <!-- Grid de archivos -->
        <div
          class="fileCard flex flex-column m-2"
          *ngFor="let file of files"
          (dblclick)="downloadFile(file)"
          (click)="selectFile(file)"
        >
          <i class="fileIcon pi pi-file file-icon"></i>
          <span class="file-name">{{ file.fileName }}</span>
          <span class="file-size" style="font-size: 0.8rem; color: gray"
            >({{ file.fileSize }})</span
          >
        </div>
      </div>
    </div>
  </div>
</div>
